
srcdir=@srcdir@
abs_top_builddir=@abs_top_builddir@
include @TOP_OBJDIR@/src/config/Makefile.config
include @TOP_OBJDIR@/src/config/Makefile.pthread

TESTS = superuser-t keys-t

MODULE_CFLAGS=-I$(srcdir)/..

all check test tests: $(TESTS)

MODULE_LIBS = 	../tap/libtap.a \
		$(abs_top_builddir)/lib/libafsauthent.a \
		$(abs_top_builddir)/lib/libafsrpc.a \
		$(abs_top_builddir)/lib/libafshcrypto.a \
		$(LIB_rfc3961) $(LIB_roken) -lafsutil\
		$(XLIBS)

superuser-t: superuser-t.o test.cs.o test.ss.o test.xdr.o
	$(AFS_LDRULE) superuser-t.o test.cs.o test.ss.o test.xdr.o \
		$(MODULE_LIBS)

keys-t: keys-t.o
	$(AFS_LDRULE) keys-t.o $(MODULE_LIBS)

writekeyfile: writekeyfile.o
	$(AFS_LDRULE) writekeyfile.o $(MODULE_LIBS)

test.cs.c: test.xg
	$(RXGEN) -A -x -C -o $@ $(srcdir)/test.xg

test.ss.c: test.xg
	$(RXGEN) -A -x -S -o $@ $(srcdir)/test.xg

test.xdr.c: test.xg
	$(RXGEN) -A -x -c -o $@ $(srcdir)/test.xg

test.h: test.xg
	$(RXGEN) -A -x -h -o $@ $(srcdir)/test.xg

superuser-t.o: test.h

clean:
	rm -f *.o *.cs.c *.ss.c *.xdr.c test.h \
		writekeyfile superuser-t keys-t
