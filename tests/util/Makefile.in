# Build rules for the OpenAFS util test suite.

srcdir=@srcdir@
abs_top_builddir=@abs_top_builddir@
include @TOP_OBJDIR@/src/config/Makefile.config
include @TOP_OBJDIR@/src/config/Makefile.lwp

MODULE_CFLAGS = -I$(TOP_OBJDIR)

LIBS = ../tap/libtap.a \
       $(abs_top_builddir)/lib/util.a \
       $(abs_top_builddir)/lib/libopr.a \
       $(abs_top_builddir)/lib/librokenafs.a

BINS = ktime-t exec-alt-t volutil-t tabular-output-t

all check test tests: $(BINS)

ktime-t: ktime-t.o $(LIBS)
	$(AFS_LDRULE) ktime-t.o $(LIBS) $(XLIBS)

exec-alt-t: exec-alt-t.o $(LIBS)
	$(AFS_LDRULE) exec-alt-t.o $(LIBS) $(XLIBS)

volutil-t: volutil-t.o $(LIBS)
	$(AFS_LDRULE) volutil-t.o $(LIBS) $(LIB_roken) $(XLIBS)

tabular-output-t: tabular-output-t.o $(LIBS)
	$(AFS_LDRULE) tabular-output-t.o $(LIBS) $(XLIBS)

install:

memtest: tabular-output-t
	valgrind --leak-check=full --track-origins=yes ./tabular-output-t

clean distclean:
	$(RM) -f $(BINS) *.o core
